<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>Fingerprint Comparator</title>
<style>
body{font-family:system-ui,Segoe UI,Roboto,Arial;margin:18px;color:#111;max-width:800px}
pre{background:#f6f6f6;padding:12px;border-radius:6px;overflow:auto}
input,textarea{width:100%;padding:8px;margin-top:6px;font-family:monospace}
.result{background:#eef;border-left:4px solid #88f;padding:8px;margin-top:12px;white-space:pre-wrap}
.diff{background:#fee;border-left:4px solid #f55;padding:8px;margin-top:6px;white-space:pre-wrap}
</style>
</head>
<body>
<h2>Fingerprint Tester & Comparator</h2>
<p>Buka halaman ini di dua browser berbeda (misal Chrome dan Firefox). Salin hasil fingerprint di bawah dari satu browser, lalu paste ke input pada browser lain dan tekan <b>Enter</b> untuk membandingkan.</p>

<h3>Fingerprint hasil deteksi otomatis</h3>
<pre id="out">Mengumpulkan data...</pre>

<h3>Bandingkan dengan fingerprint lain</h3>
<textarea id="compare" rows="8" placeholder="Paste fingerprint JSON di sini, lalu tekan Enter..."></textarea>
<div id="analysis"></div>

<script>
(async function(){
  async function collectFP(){
    const getCanvasHash = ()=>{
      try{
        const c=document.createElement('canvas');const ctx=c.getContext('2d');
        ctx.textBaseline="top";ctx.font="16px Arial";ctx.fillStyle="#f60";
        ctx.fillRect(125,1,62,20);ctx.fillStyle="#069";ctx.fillText("fp",2,15);
        return c.toDataURL().slice(0,100);
      }catch(e){return 'err:'+e;}
    };
    const getAudioFP=async()=>{
      try{
        const OfflineCtx=window.OfflineAudioContext||window.webkitOfflineAudioContext;
        if(!OfflineCtx) return 'n/a';
        const ctx=new OfflineCtx(1,44100,44100);
        const o=ctx.createOscillator();const c=ctx.createDynamicsCompressor();
        o.type='triangle';o.frequency.setValueAtTime(10000,ctx.currentTime);
        o.connect(c);c.connect(ctx.destination);
        o.start(0);o.stop(ctx.currentTime+0.1);
        const rendered=await ctx.startRendering();
        const d=rendered.getChannelData(0);let h=0;
        for(let i=4500;i<5000&&i<d.length;i++)h+=Math.abs(d[i]);
        return h.toFixed(6);
      }catch(e){return 'err:'+e;}
    };
    const getWebGL=()=>{
      try{
        const c=document.createElement('canvas');
        const gl=c.getContext('webgl')||c.getContext('experimental-webgl');
        if(!gl) return {renderer:'no-webgl'};
        const dbg=gl.getExtension('WEBGL_debug_renderer_info');
        return dbg?{
          renderer:gl.getParameter(dbg.UNMASKED_RENDERER_WEBGL),
          vendor:gl.getParameter(dbg.UNMASKED_VENDOR_WEBGL)
        }:{renderer:'nodebug'};
      }catch(e){return {renderer:'err:'+e};}
    };
    const webgl=getWebGL();
    return {
      ua:navigator.userAgent,
      platform:navigator.platform,
      lang:navigator.language,
      screen:`${screen.width}x${screen.height}`,
      dpr:devicePixelRatio,
      cores:navigator.hardwareConcurrency,
      mem:navigator.deviceMemory||'n/a',
      canvas:getCanvasHash(),
      audio:await getAudioFP(),
      webglRenderer:webgl.renderer,
      webglVendor:webgl.vendor||'n/a',
      timezone:Intl.DateTimeFormat().resolvedOptions().timeZone||'n/a'
    };
  }

  const fp=await collectFP();
  const out=document.getElementById('out');
  out.textContent=JSON.stringify(fp,null,2);

  // Compare section
  const ta=document.getElementById('compare');
  const analysis=document.getElementById('analysis');
  ta.addEventListener('keydown',e=>{
    if(e.key==='Enter' && !e.shiftKey){
      e.preventDefault();
      try{
        const other=JSON.parse(ta.value);
        const diffs=[], same=[];
        let total=0, matches=0;
        for(const k in fp){
          total++;
          if(fp[k]===other[k]){matches++;same.push(k);}
          else diffs.push(`${k}: now="${fp[k]}" vs pasted="${other[k]}"`);
        }
        const percent=Math.round((matches/total)*100);
        analysis.innerHTML=
          `<div class="result">Kecocokan: ${percent}%\nField cocok: ${same.join(', ')||'-'}</div>`+
          (diffs.length?`<div class="diff">Field berbeda:\n${diffs.join('\n')}</div>`:'');
      }catch(err){
        analysis.innerHTML=`<div class="diff">Gagal parse JSON: ${err}</div>`;
      }
    }
  });
})();
</script>
</body>
</html>
